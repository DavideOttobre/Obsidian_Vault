# ğŸ“œ 6.7 Deploy di un'app Node.js

## Introduzione

Dopo aver sviluppato un'applicazione con Node.js, Ã¨ il momento di **metterla online**.  
Vedremo come distribuire un'app Node.js su **VPS, Heroku e Railway**, e come usare **PM2** per mantenerla attiva.

ğŸ“Œ **PerchÃ© fare il deploy?**  
âœ… Rende l'app accessibile da internet.  
âœ… Permette di gestire server e scalabilitÃ .  
âœ… Automatizza il riavvio in caso di crash.

---

## ğŸ”¹ 1. Preparare il progetto per il deploy

Prima di distribuire l'app:

1ï¸âƒ£ **Aggiorna `package.json`**  
Aggiungi uno script per avviare lâ€™app:

```json
"scripts": {
    "start": "node server.js"
}
```

2ï¸âƒ£ **Installa `dotenv` per gestire variabili di ambiente**

```sh
npm install dotenv
```

Poi **crea un file `.env`** per configurare le variabili:

```
PORT=3000
```

Nel codice, carica le variabili con:

```js
require("dotenv").config();
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Server avviato su porta ${PORT}`));
```

---

## ğŸ”¹ 2. Deploy su una VPS (Linux)

Se hai una **VPS (Virtual Private Server)** con **Ubuntu**, puoi ospitare il tuo server Node.js.

### âœ… **1ï¸âƒ£ Accedi alla tua VPS**

Nel terminale locale:

```sh
ssh utente@tuo-server.com
```

### âœ… **2ï¸âƒ£ Installa Node.js sulla VPS**

```sh
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs
```

### âœ… **3ï¸âƒ£ Clona il progetto e installa le dipendenze**

```sh
git clone https://github.com/tuo-utente/tuo-progetto.git
cd tuo-progetto
npm install
```

### âœ… **4ï¸âƒ£ Avvia il server con PM2**

```sh
npm install -g pm2
pm2 start server.js --name "app-node"
pm2 save
pm2 startup
```

ğŸ“Œ **PM2 mantiene l'app attiva anche dopo un riavvio del server.**

---

## ğŸ”¹ 3. Deploy su Heroku

Se non hai una VPS, puoi usare **Heroku**, una piattaforma cloud gratuita per il deploy di app.

### âœ… **1ï¸âƒ£ Installa Heroku CLI**

Scarica e installa Heroku CLI:  
[Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli)

### âœ… **2ï¸âƒ£ Effettua il login**

```sh
heroku login
```

### âœ… **3ï¸âƒ£ Crea un'app su Heroku**

```sh
heroku create nome-app
```

### âœ… **4ï¸âƒ£ Configura variabili di ambiente**

```sh
heroku config:set PORT=3000
```

### âœ… **5ï¸âƒ£ Effettua il deploy con Git**

```sh
git init
git add .
git commit -m "Deploy su Heroku"
git push heroku main
```

### âœ… **6ï¸âƒ£ Avvia l'app**

```sh
heroku ps:scale web=1
```

ğŸ“Œ **L'app sarÃ  accessibile all'URL generato da Heroku.**

---

## ğŸ”¹ 4. Deploy su Railway (alternativa a Heroku)

Railway Ã¨ una piattaforma gratuita simile a Heroku.

### âœ… **1ï¸âƒ£ Crea un account su Railway**

Vai su [Railway.app](https://railway.app/) e accedi con GitHub.

### âœ… **2ï¸âƒ£ Collega il repository**

- Clicca su **New Project**
- Scegli **Deploy from GitHub Repo**
- Seleziona il tuo repository

### âœ… **3ï¸âƒ£ Configura variabili di ambiente**

Vai su **Settings â†’ Variables** e aggiungi:

```
PORT=3000
```

### âœ… **4ï¸âƒ£ Avvia il deploy**

Railway farÃ  tutto in automatico! ğŸ‰

---

## ğŸ”¹ 5. Configurare un dominio personalizzato

Se vuoi usare un dominio personalizzato (es. **miosito.com**), puoi configurare un **reverse proxy** con **NGINX**.

### âœ… **Configurazione base NGINX**

```sh
sudo apt install nginx
sudo nano /etc/nginx/sites-available/default
```

Aggiungi questa configurazione:

```
server {
    listen 80;
    server_name miosito.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### âœ… **Riavvia NGINX**

```sh
sudo systemctl restart nginx
```

ğŸ“Œ **Ora l'app sarÃ  raggiungibile da `miosito.com`.**

---

## ğŸ“Œ **Riepilogo**

|Metodo|Descrizione|
|---|---|
|`pm2 start server.js --name "app"`|Mantiene lâ€™app attiva su VPS|
|`heroku create nome-app`|Crea unâ€™app su Heroku|
|`git push heroku main`|Effettua il deploy su Heroku|
|`railway.app`|Alternativa gratuita a Heroku|
|`nginx`|Configura un dominio personalizzato|

---

## Collegamenti utili

- **Fine del modulo Node.js! ğŸ‰**
- **Ripassa WebSockets in Node.js â†’ [[6.6 WebSockets in Node.js]]**

---

# ðŸ“œ 8.5 Database con Node.js e MongoDB

## Introduzione

MongoDB Ã¨ un **database NoSQL orientato ai documenti**, perfetto per applicazioni moderne grazie alla sua **scalabilitÃ  e flessibilitÃ **.  
Node.js si integra facilmente con MongoDB tramite la libreria **Mongoose**, che fornisce un'interfaccia potente per la gestione dei dati.

ðŸ“Œ **PerchÃ© usare MongoDB con Node.js?**  
âœ… **Nessuna struttura fissa (NoSQL)** â†’ Perfetto per dati dinamici.  
âœ… **ScalabilitÃ  orizzontale** â†’ Ottimo per applicazioni distribuite.  
âœ… **Facile integrazione con JavaScript** â†’ Usa JSON come formato dati.  
âœ… **Mongoose** â†’ Permette di definire modelli per gestire i dati con piÃ¹ controllo.

---

## ðŸ”¹ 1. Installare MongoDB

Se non hai giÃ  installato MongoDB, puoi scaricarlo da [mongodb.com](https://www.mongodb.com/try/download/community) e avviarlo con:

```sh
mongod
```

ðŸ“Œ **Questo avvia il server MongoDB in locale sulla porta `27017`.**

Se vuoi usare un database cloud, puoi registrarti su **MongoDB Atlas** e ottenere un **URL di connessione**.

---

## ðŸ”¹ 2. Installare Mongoose in un progetto Node.js

In un progetto Node.js, installiamo Mongoose:

```sh
npm install mongoose
```

ðŸ“Œ **Mongoose fornisce un'interfaccia semplice per interagire con MongoDB.**

---

## ðŸ”¹ 3. Connettere Node.js a MongoDB

Creiamo un file `database.js` per gestire la connessione a MongoDB.

### âœ… **Connessione al database (`database.js`)**

```js
const mongoose = require("mongoose");

mongoose.connect("mongodb://localhost:27017/miodb", {
    useNewUrlParser: true,
    useUnifiedTopology: true
})
.then(() => console.log("Connesso a MongoDB"))
.catch(err => console.error("Errore di connessione:", err));
```

ðŸ“Œ **Sostituisci `"mongodb://localhost:27017/miodb"` con il tuo URL MongoDB Atlas se usi un database cloud.**

---

## ðŸ”¹ 4. Creare un Modello con Mongoose

MongoDB salva i dati in **documenti JSON**, ma con Mongoose possiamo definire **schemi** per validare e gestire i dati.

### âœ… **Definire un modello (`utente.js`)**

```js
const mongoose = require("mongoose");

const utenteSchema = new mongoose.Schema({
    nome: String,
    email: String,
    etÃ : Number
});

const Utente = mongoose.model("Utente", utenteSchema);

module.exports = Utente;
```

ðŸ“Œ **Un modello Ã¨ una rappresentazione strutturata di un documento MongoDB.**

---

## ðŸ”¹ 5. Salvare dati nel database

Ora possiamo creare e salvare un nuovo utente nel database.

### âœ… **Salvare un utente (`index.js`)**

```js
const mongoose = require("mongoose");
const Utente = require("./utente");

mongoose.connect("mongodb://localhost:27017/miodb", {
    useNewUrlParser: true,
    useUnifiedTopology: true
});

const nuovoUtente = new Utente({
    nome: "Alice",
    email: "alice@example.com",
    etÃ : 25
});

nuovoUtente.save()
    .then(() => console.log("Utente salvato con successo"))
    .catch(err => console.error("Errore:", err));
```

ðŸ“Œ **I dati vengono salvati nella collection `utentes` (MongoDB converte automaticamente il nome del modello al plurale).**

---

## ðŸ”¹ 6. Leggere dati dal database

Possiamo leggere i dati salvati con il metodo `.find()`.

### âœ… **Ottenere tutti gli utenti (`index.js`)**

```js
Utente.find()
    .then(utenti => console.log("Lista utenti:", utenti))
    .catch(err => console.error("Errore:", err));
```

ðŸ“Œ **MongoDB restituisce tutti i documenti della collection `utentes`.**

---

## ðŸ”¹ 7. Trovare un utente specifico

Possiamo cercare un utente in base a una condizione, ad esempio lâ€™email.

### âœ… **Trovare un utente per email**

```js
Utente.findOne({ email: "alice@example.com" })
    .then(utente => console.log("Utente trovato:", utente))
    .catch(err => console.error("Errore:", err));
```

ðŸ“Œ **Restituisce il primo documento che soddisfa la condizione.**

---

## ðŸ”¹ 8. Aggiornare un documento

Usiamo `.updateOne()` per modificare i dati di un utente.

### âœ… **Aggiornare l'etÃ  di un utente**

```js
Utente.updateOne({ email: "alice@example.com" }, { etÃ : 26 })
    .then(() => console.log("Utente aggiornato"))
    .catch(err => console.error("Errore:", err));
```

ðŸ“Œ **Cerca un utente con l'email specificata e aggiorna il campo `etÃ `.**

---

## ðŸ”¹ 9. Eliminare un documento

Per eliminare un utente usiamo `.deleteOne()`.

### âœ… **Eliminare un utente**

```js
Utente.deleteOne({ email: "alice@example.com" })
    .then(() => console.log("Utente eliminato"))
    .catch(err => console.error("Errore:", err));
```

ðŸ“Œ **Rimuove il primo documento che corrisponde alla condizione.**

---

## ðŸ”¹ 10. Creare un'API REST con MongoDB ed Express

Possiamo combinare MongoDB con Express per creare un'API REST.

### âœ… **Esempio di API REST (`server.js`)**

```js
const express = require("express");
const mongoose = require("mongoose");
const Utente = require("./utente");

mongoose.connect("mongodb://localhost:27017/miodb", {
    useNewUrlParser: true,
    useUnifiedTopology: true
});

const app = express();
app.use(express.json());

// Endpoint per ottenere tutti gli utenti
app.get("/api/utenti", async (req, res) => {
    const utenti = await Utente.find();
    res.json(utenti);
});

// Endpoint per creare un nuovo utente
app.post("/api/utenti", async (req, res) => {
    const nuovoUtente = new Utente(req.body);
    await nuovoUtente.save();
    res.status(201).json(nuovoUtente);
});

// Avvia il server
app.listen(3000, () => {
    console.log("API attiva su http://localhost:3000/api/utenti");
});
```

ðŸ“Œ **Ora possiamo fare richieste HTTP per salvare e leggere dati dal database.**

---

## ðŸ“Œ **Riepilogo**

|Concetto|Descrizione|
|---|---|
|**MongoDB**|Database NoSQL orientato ai documenti|
|**Mongoose**|Libreria per interagire con MongoDB|
|**`mongoose.connect()`**|Connessione al database|
|**Schema e Modelli**|Definiscono la struttura dei dati|
|**`save()`**|Salva un nuovo documento nel database|
|**`find()`**|Ottiene tutti i documenti della collection|
|**`updateOne()`**|Modifica un documento esistente|
|**`deleteOne()`**|Cancella un documento dal database|
|**Express + MongoDB**|Creazione di API REST per la gestione dei dati|

---

## Collegamenti utili

- **Prossimo argomento â†’ [[8.6 Autenticazione con Node.js e JWT]]**
- **Ripassa Node.js â†’ [[8.4 Node.js: Introduzione e Struttura]]**

---
